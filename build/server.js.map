{"version":3,"sources":["../src/server.js"],"names":[],"mappings":";;;;;QASgB,S,GAAA,S;;AAThB;;AACA;;;;AACA;;AACA;;AACA;;;;AAEA;;;AAGO,SAAS,SAAT,GAAqB;AAC1B;AACA,QAAM,MAAM,iBAAM,GAAlB;;AAEA,MAAI,KAAJ;AACA,UAAQ,GAAR,CAAY,sBAAZ;;AAEA,MAAI,EAAJ,CAAO,mBAAW,OAAlB;;AAEA,MAAI,EAAJ,CAAO,sBAAc,GAAd,CAAkB,qBAAzB,EAAgD,MAAM;AACpD;AACA,YAAQ,GAAR,CAAY,WAAZ;;AAEA,wCAA4B,IAA5B;AACD,GALD;;AAOA;AACA,yBAAS,WAAT,CAAqB,cAArB,EAAqC,MAAM;AACzC,8BAAa,eAAb;AACD,GAFD;AAGA,yBAAS,WAAT,CAAqB,cAArB,EAAqC,MAAM;AACzC,8BAAa,SAAb;AACD,GAFD;AAGA,yBAAS,WAAT,CAAqB,eAArB,EAAsC,MAAM;AAC1C,8BAAa,WAAb;AACD,GAFD;;AAIA;AACA,yBAAS,WAAT,CAAqB,cAArB;AACD","file":"server.js","sourcesContent":["import {RTM_EVENTS, CLIENT_EVENTS} from '@slack/client';\nimport schedule from 'node-schedule';\nimport {slack} from './resources';\nimport {startExpress} from './routes';\nimport {messageReceived, loadTodayOrders, makeLastCall, dropOrders} from './orders';\n\n/**\n * Starts the bot server\n */\nexport function runServer() {\n  startExpress();\n  const rtm = slack.rtm;\n\n  rtm.start();\n  console.log('slack server started');\n\n  rtm.on(RTM_EVENTS.MESSAGE, messageReceived);\n\n  rtm.on(CLIENT_EVENTS.RTM.RTM_CONNECTION_OPENED, () => {\n    // the timeout is here to go around a bug where connection is opened, but not properly established\n    console.log('Connected');\n\n    setTimeout(loadTodayOrders, 3000);\n  });\n\n  // set up last calls for each restaurant\n  schedule.scheduleJob('20 9 * * 1-5', () => {\n    makeLastCall('jedlo pod nos');\n  });\n  schedule.scheduleJob('50 9 * * 1-5', () => {\n    makeLastCall('veglife');\n  });\n  schedule.scheduleJob('50 10 * * 1-5', () => {\n    makeLastCall('spaghetti');\n  });\n\n  // delete all the orders for the new day\n  schedule.scheduleJob('0 12 * * 1-5', dropOrders);\n}\n"]}